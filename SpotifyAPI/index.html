<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statify</title>
    <link 
        href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap" 
        rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles/styles.css') }}">
    <script src="https://kit.fontawesome.com/1eeb84a983.js" crossorigin="anonymous"></script>
</head>
<body onload="initializePage();">
    {% from "trackIcons.html" import trackIcons with context %}
    {% from "trackTable.html" import trackTable with context %}

    <script>
    let activeButton = { navbar: null, sidebar: null };

    function hideAll() {
        ['shortTermTrackIcons', 'mediumTermTrackIcons', 'longTermTrackIcons', 'shortTermTrackTable', 'mediumTermTrackTable', 'longTermTrackTable']
            .forEach(id => document.getElementById(id).style.display = 'none');
    }

    function showTrackContent(id) {
        const contentIds = {
            'shortTermTracks': ['shortTermTrackIcons', 'shortTermTrackTable'],
            'mediumTermTracks': ['mediumTermTrackIcons', 'mediumTermTrackTable'],
            'longTermTracks': ['longTermTrackIcons', 'longTermTrackTable']
        };

        hideAll();
        contentIds[id]?.forEach(contentId => {
            document.getElementById(contentId).style.display = 'inline-block';
        });
    }

    function handleButtonClick(event, type) {
        if (activeButton[type] && activeButton[type] !== event.target) {
            activeButton[type].classList.remove('active');
        }

        event.target.classList.add('active');
        activeButton[type] = event.target;
    }

    function initializePage() {
        hideAll();

        document.querySelectorAll('.navbarButton').forEach(button => {
            button.addEventListener('click', (e) => handleNavbarClick(e));
        });

        document.querySelectorAll('.sidebarButton').forEach(button => {
            button.addEventListener('click', (e) => handleTrackButton(e));
        });

        const defaultHome = document.getElementById('defaultHome');
        defaultHome && handleButtonClick({ target: defaultHome }, 'sidebar');

        const default4Weeks = document.getElementById('default4Weeks');
        default4Weeks && handleButtonClick({ target: default4Weeks }, 'navbar');
    }

    function handleTrackButton(event) {
        handleButtonClick(event, 'sidebar');
        if (event.target.classList.contains('fa-music')) {
            // Show default short-term tracks if the "Tracks" button is clicked
            showTrackContent('shortTermTracks');
        } else {
            // Hide all tracks when any other sidebar button is clicked
            hideAll();
        }
    }

    function handleNavbarClick(event) {
        handleButtonClick(event, 'navbar');

        // Ensure "Top Tracks" is active before changing content
        if (activeButton['sidebar'] && activeButton['sidebar'].classList.contains('fa-music')) {
            if (event.target.id === 'default4Weeks') {
                showTrackContent('shortTermTracks');
            } else if (event.target.textContent.includes('6 MONTHS')) {
                showTrackContent('mediumTermTracks');
            } else if (event.target.textContent.includes('ALL-TIME')) {
                showTrackContent('longTermTracks');
            }
        }
    }
    </script>

    <div class="sidebar">
        <div class="logo">
            <a href="#">
                <img src="{{ url_for('static', filename='img/logoWriting.png') }}" alt="logo" />
            </a>
        </div>

        <div class="navigation">
            <ul>
                <li>
                    <button id="defaultHome" class="sidebarButton fa fa-home" onclick="handleTrackButton(event)">   Home
                    </button>
                </li>
                <li>
                    <button class="sidebarButton fa-solid fa-user" onclick="handleTrackButton(event)">  Top Artists
                    </button>
                </li>
                <li>
                    <button class="sidebarButton fa-solid fa-music" onclick="handleTrackButton(event)">  Top Tracks
                    </button>
                </li>
            </ul>
        </div>

        <div class="policies">
            <ul>
                <li>
                    <a href="#">Cookies</a>
                </li>
                <li>
                    <a href="#">Privacy</a>
                </li>
            </ul>
        </div>
    </div>

    <div class="main-container">
        <div class="topbar">
            <div class="navbar">
                <ul>
                    <li><button id="default4Weeks" class="navbarButton" onclick="showContent('shortTermTracks')">4 WEEKS</button></li>
                    <li><button class="navbarButton" onclick="showContent('mediumTermTracks')">6 MONTHS</button></li>
                    <li><button class="navbarButton" onclick="showContent('longTermTracks')">ALL-TIME</button></li>
                </ul>
            </div>
        </div>
        <div class="containerContents">
            <div id="shortTermTrackIcons" class="trackIcons">
                {{ trackIcons(short_term['items'], 'shortTermTrackIcons', 'LAST MONTH') }}
            </div>
            <div id="mediumTermTrackIcons" class="trackIcons">
                {{ trackIcons(medium_term['items'], 'mediumTermTrackIcons', 'LAST 6 MONTHS') }}
            </div>
            <div id="longTermTrackIcons" class="trackIcons">
                {{ trackIcons(long_term['items'], 'longTermTrackIcons', 'ALL TIME') }}
            </div>
            <div id="shortTermTrackTable" class="trackTable">
                {{ trackTable(short_term['items'], 'shortTermTrackTable', 'LAST MONTH') }}
            </div>
            <div id="mediumTermTrackTable" class="trackTable">
                {{ trackTable(medium_term['items'], 'mediumTermTrackTable', 'LAST 6 MONTHS') }}
            </div>
            <div id="longTermTrackTable" class="trackTable">
                {{ trackTable(long_term['items'], 'longTermTrackTable', 'ALL TIME') }}
            </div>
        </div>
    </div>
</body>
</html>